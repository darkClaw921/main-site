# Архитектура проекта main-site

## Общее описание
Веб-приложение на FastAPI для отображения текущего времени (часы:минуты:секунды:миллисекунды) с использованием кастомного шрифта Alteran. Приложение поддерживает три темы: обычная (серые цифры на черном фоне), тема "Матрица" (зеленые цифры с эффектом свечения и падающими символами) и тема "Космос" (белые цифры с голубым свечением и эффектом пролета мимо символов-звезд). Переключение между темами осуществляется циклически нажатием клавиши пробел.

## Структура проекта

```
main-site/
├── app/
│   ├── __init__.py           # Пустой файл для определения пакета Python
│   ├── main.py               # Основное FastAPI приложение
│   ├── static/               # Статические файлы (шрифты, CSS, JS)
│   │   ├── alteran.ttf       # Кастомный шрифт Alteran
│   │   ├── matrix-theme.css  # Стили для темы "Матрица"
│   │   ├── matrix-effect.js  # JavaScript для анимации эффекта падающих символов
│   │   ├── space-theme.css   # Стили для темы "Космос"
│   │   └── space-effect.js   # JavaScript для анимации эффекта пролета мимо символов-звезд
│   └── templates/            # HTML шаблоны Jinja2
│       └── index.html        # Главная страница с часами
├── alteran.ttf               # Исходный файл шрифта (копируется в static)
├── main.py                   # Старый файл (не используется)
├── run.py                    # Скрипт для запуска приложения
├── pyproject.toml            # Зависимости и конфигурация проекта
├── architecture.md           # Этот файл - описание архитектуры
└── README.md                 # Документация проекта

```

## Описание файлов

### app/main.py
Основное FastAPI приложение с:
- Настройкой статических файлов (`/static`)
- Настройкой шаблонизатора Jinja2
- Логированием через loguru
- Эндпоинтом `/` для главной страницы
- Эндпоинтом `/health` для проверки работоспособности
- Обработчиками событий startup/shutdown

### app/templates/index.html
HTML страница с:
- Подключением кастомного шрифта Alteran через @font-face
- Черным фоном (#000000)
- Серым текстом (#808080) в обычной теме
- JavaScript для обновления времени каждые 10 миллисекунд
- Адаптивным дизайном для мобильных устройств
- Центрированным отображением часов
- Двумя Canvas элементами для эффектов (Матрица и Космос)
- Обработчиком нажатия клавиши пробел для циклического переключения тем
- Плавными переходами между темами

### app/static/alteran.ttf
Кастомный шрифт для отображения времени (8.8KB). Файл должен быть скопирован из корневой директории проекта.

### app/static/matrix-theme.css
Стили для темы "Матрица":
- Зеленый цвет текста (#00ff41)
- Свечение текста (text-shadow)
- Анимация появления canvas с падающими символами
- Отдельный файл для модульности

### app/static/matrix-effect.js
JavaScript класс для эффекта падающих символов:
- Использует Canvas API для анимации
- Падающие цифры и символы с использованием шрифта Alteran
- Эффект следа (trail effect) для реалистичности
- Автоматическая адаптация к размеру экрана
- Методы start() и stop() для управления анимацией

### app/static/space-theme.css
Стили для темы "Космос":
- Белый цвет текста (#ffffff)
- Голубое свечение текста (text-shadow)
- Анимация появления canvas с пролетающими символами-звездами
- Отдельный файл для модульности

### app/static/space-effect.js
JavaScript класс для эффекта пролета мимо звезд:
- Использует Canvas API для анимации
- Символы летят от центра экрана к краям (эффект гиперпространства)
- Набор символов: цифры, английские буквы (A-Z, a-z) и знаки препинания
- Увеличенный размер символов (20-32px) для лучшей видимости
- Жирный шрифт (bold) для четкости
- Замедленная скорость движения для комфортного просмотра
- Ускорение символов по мере удаления от центра
- Эффект следа (motion blur) для реалистичности движения
- Символы отображаются шрифтом Alteran
- Автоматическая адаптация к размеру экрана
- Методы start() и stop() для управления анимацией

### run.py
Скрипт для удобного запуска приложения через uvicorn с настройками:
- Host: 0.0.0.0 (доступно из локальной сети)
- Port: 8000
- Reload: включен для разработки
- Логирование через loguru

### pyproject.toml
Зависимости проекта:
- `fastapi` - веб-фреймворк
- `uvicorn` - ASGI сервер
- `loguru` - библиотека для логирования
- `jinja2` - шаблонизатор для HTML

## Технологический стек

- **Backend**: FastAPI (Python 3.12+)
- **Server**: Uvicorn (ASGI)
- **Templating**: Jinja2
- **Logging**: Loguru
- **Frontend**: HTML5, CSS3, Vanilla JavaScript

## Функциональность

1. **Главная страница** (`/`):
   - Отображает текущее время в формате ЧЧ:ММ:СС:МММ
   - Обновляется каждые 10 миллисекунд для плавной работы
   - Использует кастомный шрифт Alteran
   - **Три темы оформления:**
     - **Обычная тема**: серые цифры (#808080) на черном фоне
     - **Тема "Матрица"**: зеленые цифры (#00ff41) с эффектом свечения + падающие символы на фоне
     - **Тема "Космос"**: белые цифры (#ffffff) с голубым свечением + эффект пролета мимо символов-звезд
   - Переключение тем по нажатию клавиши **ПРОБЕЛ** (циклически)
   - Плавные переходы между темами (0.5 секунды)
   - Полностью адаптивный дизайн

2. **Эффект "Матрица"**:
   - Падающие цифры и символы на фоне
   - Использует Canvas API для анимации
   - Символы отображаются шрифтом Alteran
   - Эффект зеленого следа (как в фильме)
   - Автоматически адаптируется к размеру окна

3. **Эффект "Космос"**:
   - Символы летят от центра экрана к краям (эффект гиперпространства)
   - Использует Canvas API для анимации
   - Символы: цифры, английские буквы (A-Z, a-z) и знаки препинания
   - Увеличенный размер (20-32px) и жирное начертание для четкости
   - Замедленная скорость для комфортного просмотра
   - Символы отображаются шрифтом Alteran
   - Ускорение по мере удаления от центра
   - Эффект следа (motion blur) для имитации скорости
   - Полупрозрачность зависит от расстояния
   - Автоматически адаптируется к размеру окна

4. **Health Check** (`/health`):
   - Простой эндпоинт для проверки работоспособности сервиса
   - Возвращает JSON с статусом

## Логирование

Все важные события логируются через loguru:
- Запуск приложения
- Остановка приложения
- Запросы к главной странице
- Логи сохраняются в файл `app.log` с ротацией при достижении 10 MB

## Запуск приложения

```bash
# Установка зависимостей
uv pip install -e .

# Запуск приложения
python run.py
```

После запуска приложение будет доступно по адресу: http://localhost:8000

## Особенности реализации

- Время берется на клиенте через JavaScript для минимальной задержки
- Шрифт загружается локально из `/static`
- Центрирование через Flexbox
- Никакой внешней зависимости от CDN или внешних ресурсов
- **Модульная архитектура**: каждая тема вынесена в отдельные файлы (CSS + JS)
- **Переключение тем**: циклическое переключение через добавление/удаление CSS классов `matrix-theme` и `space-theme`
- **Canvas анимация**: использует `requestAnimationFrame` для плавной анимации в обоих эффектах
- **Адаптивность**: все эффекты автоматически пересчитываются при изменении размера окна
- **Оптимизация**: при переключении темы все неактивные эффекты останавливаются для экономии ресурсов
- **Важно**: При первоначальной настройке необходимо скопировать файл `alteran.ttf` из корня в `app/static/`, иначе шрифт не будет отображаться

