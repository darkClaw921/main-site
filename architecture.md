# Архитектура проекта main-site

## Общее описание
Веб-приложение на FastAPI для отображения текущего времени (часы:минуты:секунды:миллисекунды) с использованием кастомного шрифта Alteran. Приложение поддерживает 14 тем с различными визуальными эффектами: Normal (серые цифры), Matrix (зеленые цифры с падающими символами), Space (белые цифры с пролетом звезд), Bounce (оранжевые с физической симуляцией), Rain (голубые с каплями дождя), Fire (желтые с огненными частицами), Pulse (фиолетовые с пульсирующими волнами), Quantum (циановые с квантовой суперпозицией), Wave (бирюзовые с волнами), Glitch (белые с глитч-эффектом), Vortex (синие со спиральным вращением), Snow (белые с падающим снегом), Lightning (желтые с молниями), Binary (зеленые с мигающим бинарным кодом). Переключение между темами осуществляется циклически нажатием клавиши пробел.

## Структура проекта

```
main-site/
├── app/
│   ├── __init__.py           # Пустой файл для определения пакета Python
│   ├── main.py               # Основное FastAPI приложение
│   ├── static/               # Статические файлы (шрифты, CSS, JS)
│   │   ├── alteran.ttf       # Кастомный шрифт Alteran
│   │   ├── matrix-theme.css  # Стили для темы "Матрица"
│   │   ├── matrix-effect.js  # JavaScript для анимации эффекта падающих символов
│   │   ├── space-theme.css   # Стили для темы "Космос"
│   │   ├── space-effect.js   # JavaScript для анимации эффекта пролета мимо символов-звезд
│   │   ├── bounce-theme.css  # Стили для темы "Bounce"
│   │   ├── bounce-effect.js  # JavaScript для физической симуляции отскока частиц
│   │   ├── rain-theme.css    # Стили для темы "Rain"
│   │   ├── rain-effect.js    # JavaScript для эффекта падающих капель
│   │   ├── fire-theme.css    # Стили для темы "Fire"
│   │   ├── fire-effect.js    # JavaScript для эффекта огненных частиц
│   │   ├── pulse-theme.css     # Стили для темы "Pulse"
│   │   ├── pulse-effect.js     # JavaScript для эффекта пульсирующих волн
│   │   ├── quantum-theme.css   # Стили для темы "Quantum"
│   │   ├── quantum-effect.js   # JavaScript для эффекта квантовой суперпозиции
│   │   ├── wave-theme.css      # Стили для темы "Wave"
│   │   ├── wave-effect.js      # JavaScript для эффекта волн
│   │   ├── glitch-theme.css    # Стили для темы "Glitch"
│   │   ├── glitch-effect.js    # JavaScript для глитч-эффекта
│   │   ├── vortex-theme.css    # Стили для темы "Vortex"
│   │   ├── vortex-effect.js    # JavaScript для спирального вращения
│   │   ├── snow-theme.css      # Стили для темы "Snow"
│   │   ├── snow-effect.js      # JavaScript для эффекта падающего снега
│   │   ├── lightning-theme.css # Стили для темы "Lightning"
│   │   ├── lightning-effect.js # JavaScript для эффекта молний
│   │   ├── binary-theme.css    # Стили для темы "Binary"
│   │   └── binary-effect.js    # JavaScript для эффекта бинарного кода
│   └── templates/              # HTML шаблоны Jinja2
│       └── index.html          # Главная страница с часами
├── alteran.ttf               # Исходный файл шрифта (копируется в static)
├── main.py                   # Старый файл (не используется)
├── run.py                    # Скрипт для запуска приложения
├── pyproject.toml            # Зависимости и конфигурация проекта
├── architecture.md           # Этот файл - описание архитектуры
└── README.md                 # Документация проекта

```

## Описание файлов

### app/main.py
Основное FastAPI приложение с:
- Настройкой статических файлов (`/static`)
- Настройкой шаблонизатора Jinja2
- Логированием через loguru
- Эндпоинтом `/` для главной страницы
- Эндпоинтом `/health` для проверки работоспособности
- Обработчиками событий startup/shutdown

### app/templates/index.html
HTML страница с:
- Подключением кастомного шрифта Alteran через @font-face
- Черным фоном (#000000)
- Серым текстом (#808080) в обычной теме
- JavaScript для обновления времени каждые 10 миллисекунд
- Адаптивным дизайном для мобильных устройств
- Центрированным отображением часов
- Семью Canvas элементами для эффектов (Matrix, Space, Bounce, Rain, Fire, Pulse, Quantum)
- Обработчиком нажатия клавиши пробел для циклического переключения тем
- Плавными переходами между темами

### app/static/alteran.ttf
Кастомный шрифт для отображения времени (8.8KB). Файл должен быть скопирован из корневой директории проекта.

### app/static/matrix-theme.css
Стили для темы "Матрица":
- Зеленый цвет текста (#00ff41)
- Свечение текста (text-shadow)
- Анимация появления canvas с падающими символами
- Отдельный файл для модульности

### app/static/matrix-effect.js
JavaScript класс для эффекта падающих символов:
- Использует Canvas API для анимации
- Падающие цифры и символы с использованием шрифта Alteran
- Эффект следа (trail effect) для реалистичности
- Автоматическая адаптация к размеру экрана
- Методы start() и stop() для управления анимацией

### app/static/space-theme.css
Стили для темы "Космос":
- Белый цвет текста (#ffffff)
- Голубое свечение текста (text-shadow)
- Анимация появления canvas с пролетающими символами-звездами
- Отдельный файл для модульности

### app/static/space-effect.js
JavaScript класс для эффекта пролета мимо звезд:
- Использует Canvas API для анимации
- Символы летят от центра экрана к краям (эффект гиперпространства)
- Набор символов: цифры, английские буквы (A-Z, a-z) и знаки препинания
- Увеличенный размер символов (20-32px) для лучшей видимости
- Жирный шрифт (bold) для четкости
- Замедленная скорость движения для комфортного просмотра
- Ускорение символов по мере удаления от центра
- Эффект следа (motion blur) для реалистичности движения
- Символы отображаются шрифтом Alteran
- Автоматическая адаптация к размеру экрана
- Методы start() и stop() для управления анимацией

### app/static/bounce-theme.css
Стили для темы "Bounce":
- Оранжевый цвет текста (#ff8800)
- Оранжевое свечение текста
- Анимация появления canvas с отскакивающими частицами

### app/static/bounce-effect.js
JavaScript класс для физической симуляции отскока:
- Частицы с символами времени движутся и отскакивают от краев экрана
- Физическая симуляция с гравитацией и упругостью
- Вращение частиц
- Эффект следа
- Синхронизация символов с текущим временем через метод updateTime()

### app/static/rain-theme.css
Стили для темы "Rain":
- Голубой цвет текста (#00ccff)
- Холодное синее свечение

### app/static/rain-effect.js
JavaScript класс для эффекта дождя:
- Капли-символы падают от часов с гравитацией
- Интенсивность зависит от текущей секунды
- Ограничение до 200 капель для производительности

### app/static/fire-theme.css
Стили для темы "Fire":
- Желтый цвет текста (#ffff00)
- Огненное желто-оранжево-красное свечение

### app/static/fire-effect.js
JavaScript класс для эффекта огня:
- Огненные частицы поднимаются вверх от символов
- Градиент цвета: желтый → оранжевый → красный → затухание
- Турбулентность и замедление
- Ограничение до 300 частиц

### app/static/pulse-theme.css
Стили для темы "Pulse":
- Фиолетовый цвет текста (#aa00ff)
- Фиолетовое свечение
- CSS анимация пульсации размера

### app/static/pulse-effect.js
JavaScript класс для эффекта пульсации:
- Концентрические волны расходятся от центра при смене секунды
- Фоновые частицы колеблются при прохождении волны
- Плавное затухание волн

### app/static/quantum-theme.css
Стили для темы "Quantum":
- Циановый цвет текста (#00ffff)
- Голубовато-белое свечение

### app/static/quantum-effect.js
JavaScript класс для эффекта квантовой суперпозиции:
- Символы мерцают между несколькими позициями
- 3-5 призрачных копий для каждого символа разбросаны по всему экрану
- Случайные вспышки между символами
- Мерцание яркости основной копии

### app/static/wave-theme.css
Стили для темы "Wave":
- Бирюзовый цвет текста (#00d4ff)
- Голубое свечение

### app/static/wave-effect.js
JavaScript класс для эффекта волн:
- Символы плавают синусоидальными волнами
- Вертикальное и горизонтальное волновое движение
- 80 плавающих частиц-символов

### app/static/glitch-theme.css
Стили для темы "Glitch":
- Белый цвет текста (#ffffff)
- RGB split свечение (красный + циановый)

### app/static/glitch-effect.js
JavaScript класс для глитч-эффекта:
- Случайные глитч-блоки с RGB разделением
- Красные и циановые артефакты
- Динамическое появление и исчезновение блоков
- Ограничение до 50 блоков для производительности

### app/static/vortex-theme.css
Стили для темы "Vortex":
- Темно-синий цвет текста (#4444ff)
- Синее свечение

### app/static/vortex-effect.js
JavaScript класс для спирального вращения:
- Символы движутся по спирали от центра к краям
- 100 частиц с разными скоростями вращения
- Эффект следа через полупрозрачную очистку
- Возврат к центру при достижении края

### app/static/snow-theme.css
Стили для темы "Snow":
- Белый цвет текста (#ffffff)
- Холодное белое свечение

### app/static/snow-effect.js
JavaScript класс для эффекта снега:
- 60 падающих снежинок-символов
- Покачивание из стороны в сторону при падении
- Разная скорость падения для каждой снежинки
- Легкое свечение символов

### app/static/lightning-theme.css
Стили для темы "Lightning":
- Ярко-желтый цвет текста (#ffff00)
- Желто-оранжевое свечение

### app/static/lightning-effect.js
JavaScript класс для эффекта молний:
- Случайные молнии между фоновыми частицами
- Зигзагообразные разряды с 8 сегментами
- 40 статичных фоновых частиц-символов
- Генерация молний каждые 300-800мс

### app/static/binary-theme.css
Стили для темы "Binary":
- Зеленый цвет текста (#00ff00)
- Зеленое свечение

### app/static/binary-effect.js
JavaScript класс для бинарного кода:
- Быстро мигающие 0 и 1 по всему экрану
- Сетка символов с динамическим переключением
- Разная прозрачность для эффекта глубины
- Эффект следа через полупрозрачную очистку

### run.py
Скрипт для удобного запуска приложения через uvicorn с настройками:
- Host: 0.0.0.0 (доступно из локальной сети)
- Port: 8000
- Reload: включен для разработки
- Логирование через loguru

### pyproject.toml
Зависимости проекта:
- `fastapi` - веб-фреймворк
- `uvicorn` - ASGI сервер
- `loguru` - библиотека для логирования
- `jinja2` - шаблонизатор для HTML

## Технологический стек

- **Backend**: FastAPI (Python 3.12+)
- **Server**: Uvicorn (ASGI)
- **Templating**: Jinja2
- **Logging**: Loguru
- **Frontend**: HTML5, CSS3, Vanilla JavaScript

## Функциональность

1. **Главная страница** (`/`):
   - Отображает текущее время в формате ЧЧ:ММ:СС:МММ
   - Обновляется каждые 10 миллисекунд для плавной работы
   - Использует кастомный шрифт Alteran
   - **14 тем оформления:**
     - **Normal**: серые цифры (#808080) на черном фоне
     - **Matrix**: зеленые цифры (#00ff41) + падающие символы
     - **Space**: белые цифры (#ffffff) + эффект пролета звезд
     - **Bounce**: оранжевые цифры (#ff8800) + физическая симуляция отскока
     - **Rain**: голубые цифры (#00ccff) + капли дождя с гравитацией
     - **Fire**: желтые цифры (#ffff00) + огненные частицы с градиентом
     - **Pulse**: фиолетовые цифры (#aa00ff) + концентрические волны из символов
     - **Quantum**: циановые цифры (#00ffff) + квантовая суперпозиция по всему экрану
     - **Wave**: бирюзовые цифры (#00d4ff) + синусоидальные волны
     - **Glitch**: белые цифры (#ffffff) + цифровой глитч с RGB split
     - **Vortex**: темно-синие цифры (#4444ff) + спиральное вращение
     - **Snow**: белые цифры (#ffffff) + падающие снежинки
     - **Lightning**: ярко-желтые цифры (#ffff00) + электрические молнии
     - **Binary**: зеленые цифры (#00ff00) + мигающий бинарный код
   - Переключение тем по нажатию клавиши **ПРОБЕЛ** (циклически)
   - Плавные переходы между темами (0.5 секунды)
   - Полностью адаптивный дизайн

2. **Эффект "Матрица"**:
   - Падающие цифры и символы на фоне
   - Использует Canvas API для анимации
   - Символы отображаются шрифтом Alteran
   - Эффект зеленого следа (как в фильме)
   - Автоматически адаптируется к размеру окна

3. **Эффект "Космос"**:
   - Символы летят от центра экрана к краям (эффект гиперпространства)
   - Использует Canvas API для анимации
   - Символы: цифры, английские буквы (A-Z, a-z) и знаки препинания
   - Увеличенный размер (20-32px) и жирное начертание для четкости
   - Замедленная скорость для комфортного просмотра
   - Символы отображаются шрифтом Alteran
   - Ускорение по мере удаления от центра
   - Эффект следа (motion blur) для имитации скорости
   - Полупрозрачность зависит от расстояния
   - Автоматически адаптируется к размеру окна

4. **Эффект "Bounce"**:
   - Физическая симуляция отскока частиц с символами времени
   - 13 частиц (по одной на каждый символ времени HH:MM:SS:MMM)
   - Отскок от краев экрана с коэффициентом упругости 0.85
   - Вращение частиц
   - Эффект следа через полупрозрачную очистку canvas
   - Синхронизация символов с текущим временем

5. **Эффект "Rain"**:
   - Капли-символы падают от позиций часов вниз
   - Гравитация 0.3 px/frame², максимальная скорость 8 px/frame
   - Интенсивность генерации зависит от текущей секунды
   - Ограничение до 200 капель для производительности
   - Затухание прозрачности к концу жизни

6. **Эффект "Fire"**:
   - Огненные частицы поднимаются вверх от символов
   - Градиент цвета: желтый → оранжевый → красный → затухание
   - Турбулентность (случайные отклонения)
   - Замедление по мере подъема
   - Ограничение до 300 частиц

7. **Эффект "Pulse"**:
   - Концентрические волны из маленьких символов расходятся от центра при смене секунды
   - Волны состоят из символов (не линий) расположенных по окружности
   - 30 фоновых частиц-символов медленно дрейфуют
   - Частицы колеблются при прохождении волны
   - Оптимизировано: макс 5 волн, макс 60 символов на волну, увеличенная скорость

8. **Эффект "Quantum"**:
   - Каждый символ имеет 3-5 позиций (эффект суперпозиции)
   - Основная копия в центре, призрачные копии разбросаны по всему экрану
   - Основная копия яркая (opacity 1.0), призрачные копии полупрозрачные (0.2-0.5)
   - Мерцание яркости основной копии
   - Случайные белые вспышки между символами
   - Обновление позиций каждые 75мс

9. **Эффект "Wave"**:
   - 80 символов плавают синусоидальными волнами
   - Вертикальное волнообразное движение
   - Горизонтальное покачивание
   - Плавная анимация с wrap-around по краям

10. **Эффект "Glitch"**:
    - Случайные глитч-блоки появляются и исчезают
    - RGB split эффект (красные и циановые артефакты)
    - Символы дергаются и смещаются
    - Генерация блоков каждые 100-300мс
    - Ограничение до 50 блоков

11. **Эффект "Vortex"**:
    - 100 символов вращаются по спирали от центра к краям
    - Спиральное движение с увеличением радиуса
    - Возврат к центру при достижении края
    - Эффект следа через полупрозрачную очистку
    - Общее вращение всей спирали

12. **Эффект "Snow"**:
    - 60 снежинок-символов падают сверху вниз
    - Покачивание из стороны в сторону (синусоидальное движение)
    - Разная скорость падения для каждой снежинки
    - Легкое белое свечение
    - Возврат наверх при достижении низа

13. **Эффект "Lightning"**:
    - Случайные молнии соединяют фоновые частицы
    - 40 статичных фоновых частиц-символов
    - Зигзагообразные молнии с 8 сегментами
    - Генерация молний каждые 300-800мс
    - Яркое желтое свечение разрядов

14. **Эффект "Binary"**:
    - Сетка из быстро мигающих 0 и 1
    - Символы переключаются каждые 50-150мс
    - Разная прозрачность для эффекта глубины
    - Эффект следа через полупрозрачную очистку
    - Зеленое свечение для ярких символов

15. **Health Check** (`/health`):
   - Простой эндпоинт для проверки работоспособности сервиса
   - Возвращает JSON с статусом

## Логирование

Все важные события логируются через loguru:
- Запуск приложения
- Остановка приложения
- Запросы к главной странице
- Логи сохраняются в файл `app.log` с ротацией при достижении 10 MB

## Запуск приложения

```bash
# Установка зависимостей
uv sync

# Запуск приложения
uv run run.py
```

После запуска приложение будет доступно по адресу: http://localhost:8000

## Особенности реализации

- Время берется на клиенте через JavaScript для минимальной задержки
- Шрифт загружается локально из `/static`
- Центрирование через Flexbox
- Никакой внешней зависимости от CDN или внешних ресурсов
- **Модульная архитектура**: каждая тема вынесена в отдельные файлы (CSS + JS)
- **Переключение тем**: циклическое переключение через добавление/удаление CSS классов тем
- **Canvas анимация**: использует `requestAnimationFrame` для плавной анимации во всех эффектах
- **Физическая симуляция**: тема Bounce использует реалистичную физику с отскоком, вращением и затуханием
- **Адаптивность**: все эффекты автоматически пересчитываются при изменении размера окна
- **Оптимизация**: при переключении темы все неактивные эффекты останавливаются для экономии ресурсов
- **Ограничение частиц**: Rain ограничен 200 частицами, Fire — 300 для поддержания производительности
- **Важно**: При первоначальной настройке необходимо скопировать файл `alteran.ttf` из корня в `app/static/`, иначе шрифт не будет отображаться

